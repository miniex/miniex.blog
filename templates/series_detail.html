{% extends "_base.html" %} {% import "_components.html" as components %} {%
block head %}
<title>{{ blog.title }} - {{ series_name }}</title>
<meta name="description" content="{{ blog.description }}" />
<meta property="og:title" content="{{ blog.title }}" />
<meta property="og:description" content="{{ blog.description }}" />
<meta property="og:type" content="{{ blog.og_type }}" />
<meta property="og:url" content="{{ blog.url }}" />
<meta property="og:site_name" content="miniex.blog" />
<meta
  property="og:image"
  content="https://miniex.blog/assets/favicon/sakura-flower-512-238032.png"
/>
<meta property="og:locale" content="{{ lang.as_str() }}" />
<link rel="canonical" href="{{ blog.url }}" />
{% endblock %} {% block main %}
<div class="container mx-auto px-4 max-w-4xl">
  <!-- Series Header -->
  <div
    class="bg-base-100/80 rounded-3xl border border-base-300/25 mb-8 sm:mb-12 p-5 sm:p-8"
  >
    <div class="text-center">
      <div
        class="flex flex-wrap items-center justify-center gap-2 sm:gap-3 mb-4"
      >
        <h1 class="text-3xl sm:text-4xl font-bold text-base-content">
          {{ series_name }}
        </h1>
        {% match series_status %} {% when crate::post::SeriesStatus::Completed
        %}
        <span class="badge badge-success gap-1">
          <i class="ph ph-check-circle text-xs"></i>
          {{ t.series_completed }}
        </span>
        {% when crate::post::SeriesStatus::Ongoing %}
        <span class="badge badge-info gap-1">
          <i class="ph ph-spinner text-xs"></i>
          {{ t.series_ongoing }}
        </span>
        {% endmatch %}
      </div>

      {% if let Some(desc) = series_description %}
      <p class="text-base-content/60 max-w-xl mx-auto mb-4 text-sm">
        {{ desc }}
      </p>
      {% endif %}

      <div class="flex flex-wrap justify-center gap-2 mb-4">
        {% for author in authors %}
        <div
          class="badge badge-md sm:badge-lg bg-primary/6 border-primary/10 gap-1.5 sm:gap-2 py-2 px-3 sm:py-3 sm:px-4"
        >
          <i class="ph ph-user text-sm"></i>
          <span>{{ author }}</span>
        </div>
        {% endfor %}
      </div>

      <div
        class="flex justify-center items-center gap-2 text-base-content/50 text-sm"
      >
        <i class="ph ph-clock text-sm"></i>
        <span>{{ t.series_last_updated }} {{ updated_at|date }}</span>
      </div>
    </div>
  </div>

  <div id="sort-content">
    <!-- Sort Toggle -->
    <div class="flex justify-end mb-6">
      {% if sort_asc %}
      <a
        hx-get="?sort=desc"
        hx-target="#sort-content"
        hx-select="#sort-content"
        hx-swap="outerHTML transition:true"
        hx-push-url="true"
        class="flex items-center gap-1.5 bg-primary/6 hover:bg-primary/12 text-base-content/70 hover:text-primary rounded-full px-4 py-1.5 text-sm transition-all duration-200 cursor-pointer"
      >
        <i class="ph ph-sort-ascending text-sm"></i>
        {{ t.sort_oldest_first }}
      </a>
      {% else %}
      <a
        hx-get="?sort=asc"
        hx-target="#sort-content"
        hx-select="#sort-content"
        hx-swap="outerHTML transition:true"
        hx-push-url="true"
        class="flex items-center gap-1.5 bg-primary/6 hover:bg-primary/12 text-base-content/70 hover:text-primary rounded-full px-4 py-1.5 text-sm transition-all duration-200 cursor-pointer"
      >
        <i class="ph ph-sort-descending text-sm"></i>
        {{ t.sort_newest_first }}
      </a>
      {% endif %}
    </div>

    <!-- Posts Timeline -->
    <div class="relative mx-0 sm:mx-12">
      <!-- Timeline center line -->
      <div
        class="hidden sm:block absolute left-0 top-0 bottom-0 w-px bg-gradient-to-b from-primary/20 via-secondary/15 to-primary/10 rounded-full mx-auto right-0"
      ></div>

      <div class="relative z-10">
        {% if posts.len() > 0 %} {% for post in posts %}
        <div class="relative mb-12 last:mb-0">
          <!-- Timeline node -->
          <div
            class="hidden sm:block absolute left-0 right-0 mx-auto w-3 h-3 rounded-full bg-primary/20 border-2 border-base-100 top-14 timeline-node transition-colors duration-300"
          ></div>

          <!-- Post card with offset -->
          <div
            class="ml-0 sm:ml-12 transform transition-all duration-500 timeline-item"
          >
            {% call components::post_card(post=post) %}
          </div>
        </div>
        {% endfor %} {% else %}
        <div
          class="flex flex-col items-center justify-center py-16 bg-base-100/80 rounded-3xl border border-base-300/25 text-center my-8 ml-0 sm:ml-12"
        >
          <i class="ph ph-article text-5xl text-base-content/20 mb-4"></i>
          <h3 class="text-lg font-semibold mb-2">{{ t.series_no_posts }}</h3>
          <p class="text-sm text-base-content/50 mb-6 max-w-md">
            {{ t.series_no_posts_message }}
          </p>
          <a href="/series" class="btn btn-primary btn-sm"
            >{{ t.series_view_all }}</a
          >
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<style>
  /* Timeline animations */
  .timeline-node {
    transition: all 0.3s;
  }

  .timeline-item {
    opacity: 0;
    animation: fadeSlideIn 0.5s ease-out forwards;
    animation-delay: calc(var(--index, 0) * 150ms);
  }

  @keyframes fadeSlideIn {
    from {
      opacity: 0;
      transform: translateX(20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  /* Apply animation delays to timeline items */
  .timeline-item:nth-child(1) {
    --index: 1;
  }
  .timeline-item:nth-child(2) {
    --index: 2;
  }
  .timeline-item:nth-child(3) {
    --index: 3;
  }
  .timeline-item:nth-child(4) {
    --index: 4;
  }
  .timeline-item:nth-child(5) {
    --index: 5;
  }
  .timeline-item:nth-child(6) {
    --index: 6;
  }
  .timeline-item:nth-child(7) {
    --index: 7;
  }
  .timeline-item:nth-child(8) {
    --index: 8;
  }
  .timeline-item:nth-child(9) {
    --index: 9;
  }
  .timeline-item:nth-child(10) {
    --index: 10;
  }
</style>

<script>
  // Initialize IntersectionObserver for scroll animations
  document.addEventListener("DOMContentLoaded", function () {
    const timelineItems = document.querySelectorAll(".timeline-item");
    const timelineNodes = document.querySelectorAll(".timeline-node");

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.style.opacity = "1";
            entry.target.style.transform = "translateX(0)";

            // Find the associated node and animate it
            const index = Array.from(timelineItems).indexOf(entry.target);
            if (index >= 0 && timelineNodes[index]) {
              timelineNodes[index].style.backgroundColor = "hsl(var(--p))";
              timelineNodes[index].style.borderColor = "hsl(var(--p))";
            }
          }
        });
      },
      {
        threshold: 0.2,
      },
    );

    timelineItems.forEach((item) => {
      observer.observe(item);
    });
  });
</script>
{% endblock %}
