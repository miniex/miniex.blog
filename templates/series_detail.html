{% extends "_base.html" %} {% import "_components.html" as components %} {%
block head %}
<title>{{ blog.title }} - {{ series_name }}</title>
<meta name="description" content="{{ blog.description }}" />
<meta property="og:title" content="{{ blog.title }}" />
<meta property="og:description" content="{{ blog.description }}" />
<meta property="og:type" content="{{ blog.og_type }}" />
<meta property="og:url" content="{{ blog.url }}" />
<meta property="og:site_name" content="miniex.blog" />
<meta
  property="og:image"
  content="https://miniex.blog/assets/favicon/sakura-flower-512-238032.png"
/>
<meta property="og:locale" content="{{ lang.as_str() }}" />
<link rel="canonical" href="{{ blog.url }}" />
{% endblock %} {% block main %}
<div class="container mx-auto px-3 sm:px-4 max-w-4xl">
  <!-- Series Header -->
  <div class="relative overflow-hidden rounded-2xl sm:rounded-3xl border border-base-300/20 mb-8 sm:mb-10">
    <!-- Background layers -->
    <div class="absolute inset-0 bg-gradient-to-br from-primary/5 via-base-100 to-secondary/5"></div>
    <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_top_right,_var(--tw-gradient-stops))] from-primary/4 via-transparent to-transparent"></div>
    <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-primary via-secondary to-accent"></div>

    <div class="relative p-5 sm:p-8">
      <!-- Back link -->
      <a
        href="/series"
        class="inline-flex items-center gap-1.5 text-xs text-base-content/40 hover:text-primary transition-all duration-200 mb-6 group/back"
      >
        <i class="ph ph-arrow-left text-xs group-hover/back:-translate-x-0.5 transition-transform duration-200"></i>
        {{ t.series_view_all }}
      </a>

      <!-- Title + Status -->
      <div class="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 mb-4">
        <h1 class="text-2xl sm:text-3xl font-bold text-base-content tracking-tight">
          {{ series_name }}
        </h1>
        {% match series_status %} {% when crate::post::SeriesStatus::Completed %}
        <span class="inline-flex items-center gap-1.5 text-xs font-semibold text-success bg-success/10 px-3 py-1.5 rounded-full w-fit border border-success/15">
          <i class="ph ph-check-circle text-sm"></i>
          {{ t.series_completed }}
        </span>
        {% when crate::post::SeriesStatus::Ongoing %}
        <span class="inline-flex items-center gap-1.5 text-xs font-semibold text-info bg-info/10 px-3 py-1.5 rounded-full w-fit border border-info/15">
          <i class="ph ph-spinner text-sm"></i>
          {{ t.series_ongoing }}
        </span>
        {% endmatch %}
      </div>

      {% if let Some(desc) = series_description %}
      <p class="text-base-content/55 text-sm leading-relaxed max-w-2xl mb-6">
        {{ desc }}
      </p>
      {% endif %}

      <!-- Stats chips -->
      <div class="flex flex-wrap items-center gap-2">
        {% for author in authors %}
        <div class="inline-flex items-center gap-1.5 text-xs text-base-content/55 bg-base-200/40 px-3 py-1.5 rounded-full">
          <i class="ph ph-user text-sm text-primary/50"></i>
          <span>{{ author }}</span>
        </div>
        {% endfor %}
        <div class="inline-flex items-center gap-1.5 text-xs text-base-content/55 bg-base-200/40 px-3 py-1.5 rounded-full">
          <i class="ph ph-article text-sm text-primary/50"></i>
          <span>{{ total_posts }} {{ t.series_posts_count }}</span>
        </div>
        <div class="inline-flex items-center gap-1.5 text-xs text-base-content/55 bg-base-200/40 px-3 py-1.5 rounded-full">
          <i class="ph ph-calendar-blank text-sm text-primary/50"></i>
          <time>{{ updated_at|date }}</time>
        </div>
      </div>

      <!-- Progress bar -->
      {% match series_status %} {% when crate::post::SeriesStatus::Completed %}
      <div class="mt-6">
        <div class="flex items-center justify-between text-[11px] text-base-content/40 mb-1.5">
          <span>{{ t.series_completed }}</span>
          <span>{{ total_posts }}/{{ total_posts }}</span>
        </div>
        <div class="w-full bg-base-200/60 rounded-full h-2 overflow-hidden">
          <div class="bg-gradient-to-r from-primary to-secondary h-full rounded-full w-full transition-all duration-700"></div>
        </div>
      </div>
      {% when crate::post::SeriesStatus::Ongoing %}
      {% endmatch %}
    </div>
  </div>

  <div id="sort-content">
    <!-- Sort Toggle -->
    <div class="flex justify-end mb-6">
      {% if sort_asc %}
      <a
        hx-get="?sort=desc"
        hx-target="#sort-content"
        hx-select="#sort-content"
        hx-swap="outerHTML transition:true"
        hx-push-url="true"
        class="inline-flex items-center gap-1.5 bg-base-200/50 hover:bg-primary/10 text-base-content/55 hover:text-primary rounded-full px-3.5 py-1.5 text-xs font-medium transition-all duration-200 cursor-pointer border border-base-300/15 hover:border-primary/20"
      >
        <i class="ph ph-sort-ascending text-sm"></i>
        {{ t.sort_oldest_first }}
      </a>
      {% else %}
      <a
        hx-get="?sort=asc"
        hx-target="#sort-content"
        hx-select="#sort-content"
        hx-swap="outerHTML transition:true"
        hx-push-url="true"
        class="inline-flex items-center gap-1.5 bg-base-200/50 hover:bg-primary/10 text-base-content/55 hover:text-primary rounded-full px-3.5 py-1.5 text-xs font-medium transition-all duration-200 cursor-pointer border border-base-300/15 hover:border-primary/20"
      >
        <i class="ph ph-sort-descending text-sm"></i>
        {{ t.sort_newest_first }}
      </a>
      {% endif %}
    </div>

    <!-- Timeline Posts List -->
    {% if posts.len() > 0 %}
    <div class="relative series-timeline">
      <!-- Vertical timeline line -->
      <div class="absolute left-[15px] sm:left-[19px] top-4 bottom-4 w-px bg-gradient-to-b from-primary/20 via-primary/10 to-transparent"></div>

      <div class="space-y-0">
        {% for post in posts %}
        <div class="relative flex items-stretch gap-3 sm:gap-5 series-item group/item">
          <!-- Timeline node -->
          <div class="flex-shrink-0 flex flex-col items-center z-10 pt-5">
            <div class="w-[31px] h-[31px] sm:w-[39px] sm:h-[39px] rounded-full bg-base-100 border-2 border-primary/20 group-hover/item:border-primary/50 flex items-center justify-center transition-all duration-300 group-hover/item:shadow-md group-hover/item:shadow-primary/10">
              <span class="text-[11px] sm:text-xs font-bold text-primary/60 group-hover/item:text-primary transition-colors duration-300">
                {% match post.metadata.series_order %}{% when Some with (order) %}{{ order }}{% when None %}{{ loop.index }}{% endmatch %}
              </span>
            </div>
          </div>

          <!-- Card -->
          <div class="flex-1 min-w-0 py-2">
            {% call components::post_card(post=post) %}
          </div>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Pagination -->
    {% if total_pages > 1 %}
    <div class="flex justify-center mt-10 mb-4">
      <div class="inline-flex items-center gap-1 bg-base-200/30 rounded-full px-2 py-1 border border-base-300/15">
        {% if let Some(prev) = prev_page %}
        <a
          href="?page={{ prev }}{% if sort_asc %}&sort=asc{% endif %}"
          class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-primary/10 hover:text-primary text-base-content/50 transition-all duration-200 text-sm"
        >
          <i class="ph ph-caret-left"></i>
        </a>
        {% endif %}
        {% for page_num in page_numbers %}
        <a
          href="?page={{ page_num }}{% if sort_asc %}&sort=asc{% endif %}"
          class="w-8 h-8 flex items-center justify-center rounded-full text-xs font-medium transition-all duration-200 {% if current_page|to_ref == page_num %}bg-primary text-primary-content shadow-sm{% else %}hover:bg-primary/10 hover:text-primary text-base-content/60{% endif %}"
        >{{ page_num }}</a>
        {% endfor %}
        {% if let Some(next) = next_page %}
        <a
          href="?page={{ next }}{% if sort_asc %}&sort=asc{% endif %}"
          class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-primary/10 hover:text-primary text-base-content/50 transition-all duration-200 text-sm"
        >
          <i class="ph ph-caret-right"></i>
        </a>
        {% endif %}
      </div>
    </div>
    {% endif %}

    {% else %}
    <div
      class="flex flex-col items-center justify-center py-20 bg-base-100/80 rounded-3xl border border-base-300/20 text-center"
    >
      <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-primary/8 to-secondary/8 flex items-center justify-center mb-5">
        <i class="ph ph-article text-3xl text-primary/30"></i>
      </div>
      <h3 class="text-lg font-semibold mb-2">{{ t.series_no_posts }}</h3>
      <p class="text-sm text-base-content/50 mb-6 max-w-md">
        {{ t.series_no_posts_message }}
      </p>
      <a href="/series" class="btn btn-primary btn-sm rounded-full px-6">{{ t.series_view_all }}</a>
    </div>
    {% endif %}
  </div>
</div>

{% endblock %}
