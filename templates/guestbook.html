{% extends "_base.html" %} {% block head %}
<title>miniex::guestbook</title>
<meta name="description" content="{{ t.guestbook_subtitle }}" />
<meta property="og:title" content="miniex::guestbook" />
<meta property="og:description" content="{{ t.guestbook_subtitle }}" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://miniex.blog/guestbook" />
<meta property="og:site_name" content="miniex.blog" />
<meta
  property="og:image"
  content="https://miniex.blog/assets/favicon/sakura-flower-512-238032.png"
/>
<meta property="og:locale" content="{{ lang.as_str() }}" />
<link rel="canonical" href="https://miniex.blog/guestbook" />
{% endblock %} {% block main %}
<div class="container mx-auto px-3 sm:px-4 max-w-3xl">
  <!-- Header -->
  <div class="text-center mb-10">
    <div class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-primary/6 border border-primary/10 mb-4">
      <i class="ph ph-chat-circle text-sm text-primary/60"></i>
      <span class="text-xs font-medium text-primary/70">{{ total_entries }} messages</span>
    </div>
    <h1 class="text-3xl sm:text-4xl font-bold mb-3 text-base-content tracking-tight">
      {{ t.guestbook_title }}
    </h1>
    <p class="text-base-content/45 max-w-lg mx-auto text-sm leading-relaxed">
      {{ t.guestbook_subtitle }}
    </p>
  </div>

  <!-- Write New Entry -->
  <div class="relative overflow-hidden rounded-2xl border border-base-300/20 mb-10">
    <div class="absolute top-0 left-0 w-full h-0.5 bg-gradient-to-r from-primary/30 via-secondary/30 to-accent/30"></div>
    <div class="p-5 sm:p-7">
      <div class="flex items-center gap-2.5 mb-5">
        <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-primary/12 to-secondary/12 flex items-center justify-center">
          <i class="ph ph-pencil-simple text-primary/60 text-sm"></i>
        </div>
        <h2 class="text-base font-semibold">{{ t.guestbook_write_new }}</h2>
      </div>

      <form id="guestbook-form" class="space-y-4">
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <label class="block text-xs font-medium text-base-content/55 mb-1.5 ml-1" for="author">
              {{ t.guestbook_name }}
            </label>
            <input
              type="text"
              id="author"
              name="author"
              placeholder="{{ t.guestbook_name_placeholder }}"
              class="input input-bordered input-sm w-full rounded-xl bg-base-200/20 border-base-300/25 focus:border-primary/30 focus:bg-base-100 transition-all duration-200 h-10"
              required
              autocomplete="off"
            />
          </div>
          <div>
            <label class="block text-xs font-medium text-base-content/55 mb-1.5 ml-1" for="password">
              {{ t.guestbook_password }}
              <span class="text-base-content/30 font-normal ml-1">{{ t.guestbook_password_hint }}</span>
            </label>
            <input
              type="password"
              id="password"
              name="password"
              placeholder="{{ t.guestbook_password_placeholder }}"
              class="input input-bordered input-sm w-full rounded-xl bg-base-200/20 border-base-300/25 focus:border-primary/30 focus:bg-base-100 transition-all duration-200 h-10"
              autocomplete="new-password"
            />
          </div>
        </div>

        <div>
          <label class="block text-xs font-medium text-base-content/55 mb-1.5 ml-1" for="content">
            {{ t.guestbook_message }}
          </label>
          <textarea
            id="content"
            name="content"
            placeholder="{{ t.guestbook_message_placeholder }}"
            class="textarea textarea-bordered w-full h-28 resize-none rounded-xl bg-base-200/20 border-base-300/25 focus:border-primary/30 focus:bg-base-100 transition-all duration-200 p-3 text-sm"
            required
          ></textarea>
        </div>

        <div class="flex justify-end">
          <button type="submit" class="inline-flex items-center gap-2 px-5 py-2 bg-primary text-primary-content rounded-full text-sm font-medium shadow-sm shadow-primary/15 hover:shadow-md hover:shadow-primary/20 hover:-translate-y-0.5 transition-all duration-200">
            <i class="ph ph-paper-plane-right text-sm"></i>
            {{ t.guestbook_submit }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Entries Section -->
  <div id="sort-content">
    <div class="flex items-center justify-between mb-6">
      <div class="flex items-center gap-2.5">
        <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-primary/12 to-secondary/12 flex items-center justify-center">
          <i class="ph ph-chat-circle text-primary/60 text-sm"></i>
        </div>
        <h2 class="text-base font-semibold">{{ t.guestbook_recent }}</h2>
      </div>
      {% if sort_asc %}
      <a
        hx-get="?sort=desc"
        hx-target="#sort-content"
        hx-select="#sort-content"
        hx-swap="outerHTML transition:true"
        hx-push-url="true"
        class="inline-flex items-center gap-1.5 bg-base-200/50 hover:bg-primary/10 text-base-content/55 hover:text-primary rounded-full px-3.5 py-1.5 text-xs font-medium transition-all duration-200 cursor-pointer border border-base-300/15 hover:border-primary/20"
      >
        <i class="ph ph-sort-ascending text-sm"></i>
        {{ t.sort_oldest_first }}
      </a>
      {% else %}
      <a
        hx-get="?sort=asc"
        hx-target="#sort-content"
        hx-select="#sort-content"
        hx-swap="outerHTML transition:true"
        hx-push-url="true"
        class="inline-flex items-center gap-1.5 bg-base-200/50 hover:bg-primary/10 text-base-content/55 hover:text-primary rounded-full px-3.5 py-1.5 text-xs font-medium transition-all duration-200 cursor-pointer border border-base-300/15 hover:border-primary/20"
      >
        <i class="ph ph-sort-descending text-sm"></i>
        {{ t.sort_newest_first }}
      </a>
      {% endif %}
    </div>

    <div id="guestbook-entries" class="space-y-3">
      {% if entries.len() > 0 %} {% for entry in entries %}
      <div
        class="group relative rounded-2xl border border-base-300/15 hover:border-primary/15 bg-base-100/60 hover:bg-base-100 p-4 sm:p-5 transition-all duration-300 guestbook-item"
      >
        <!-- Author + Date row -->
        <div class="flex items-center justify-between mb-3">
          <div class="flex items-center gap-2.5">
            <!-- Avatar circle -->
            <div class="w-8 h-8 rounded-full bg-gradient-to-br from-primary/15 to-secondary/15 flex items-center justify-center flex-shrink-0">
              <span class="text-xs font-bold text-primary/60">{{ entry.author.chars().next().unwrap_or('?') }}</span>
            </div>
            <div class="flex flex-col sm:flex-row sm:items-baseline sm:gap-2">
              <span class="text-sm font-semibold text-base-content">{{ entry.author }}</span>
              <span class="text-[11px] text-base-content/35">
                {{ entry.created_at.format("%Y-%m-%d %H:%M") }}
              </span>
            </div>
          </div>

          <!-- Action buttons -->
          <div class="flex gap-0.5 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
            {% if entry.password_hash.is_some() %}
            <button
              class="w-7 h-7 flex items-center justify-center rounded-full hover:bg-primary/10 text-base-content/30 hover:text-primary transition-all duration-200 edit-btn"
              data-id="{{ entry.id }}"
              aria-label="Edit entry"
            >
              <i class="ph ph-pencil-simple text-sm"></i>
            </button>
            {% endif %}
            <button
              class="w-7 h-7 flex items-center justify-center rounded-full hover:bg-error/10 text-base-content/30 hover:text-error transition-all duration-200 delete-btn"
              data-id="{{ entry.id }}"
              aria-label="Delete entry"
            >
              <i class="ph ph-trash text-sm"></i>
            </button>
          </div>
        </div>

        <!-- Content -->
        <!-- prettier-ignore -->
        <div class="pl-[42px]">
          <p class="text-base-content/70 whitespace-pre-wrap leading-relaxed text-sm">{{ entry.content }}</p>
        </div>
      </div>
      {% endfor %}
    </div>

    <!-- Pagination -->
    {% if total_pages > 1 %}
    <div class="flex justify-center mt-8 mb-4">
      <div class="inline-flex items-center gap-1 bg-base-200/30 rounded-full px-2 py-1 border border-base-300/15">
        {% if let Some(prev) = prev_page %}
        <a
          href="?page={{ prev }}{% if sort_asc %}&sort=asc{% endif %}"
          class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-primary/10 hover:text-primary text-base-content/50 transition-all duration-200 text-sm"
        >
          <i class="ph ph-caret-left"></i>
        </a>
        {% endif %}
        {% for page_num in page_numbers %}
        <a
          href="?page={{ page_num }}{% if sort_asc %}&sort=asc{% endif %}"
          class="w-8 h-8 flex items-center justify-center rounded-full text-xs font-medium transition-all duration-200 {% if current_page|to_ref == page_num %}bg-primary text-primary-content shadow-sm{% else %}hover:bg-primary/10 hover:text-primary text-base-content/60{% endif %}"
        >{{ page_num }}</a>
        {% endfor %}
        {% if let Some(next) = next_page %}
        <a
          href="?page={{ next }}{% if sort_asc %}&sort=asc{% endif %}"
          class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-primary/10 hover:text-primary text-base-content/50 transition-all duration-200 text-sm"
        >
          <i class="ph ph-caret-right"></i>
        </a>
        {% endif %}
      </div>
    </div>
    {% endif %}

    {% else %}
    <div class="flex flex-col items-center justify-center py-20 bg-base-100/60 rounded-2xl border border-base-300/15 text-center">
      <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/8 to-secondary/8 flex items-center justify-center mb-4">
        <i class="ph ph-chat-circle text-2xl text-primary/25"></i>
      </div>
      <h3 class="text-base font-semibold mb-1.5">
        {{ t.guestbook_no_entries }}
      </h3>
      <p class="text-sm text-base-content/40">
        {{ t.guestbook_no_entries_message }}
      </p>
    </div>
    {% endif %}
  </div>
</div>

<script src="/assets/js/guestbook.js?v={{ blog.v }}" defer></script>
{% endblock %}
